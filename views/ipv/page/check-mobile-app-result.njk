{% extends "shared/base.njk" %}
{% from "components/journey-next-form.njk" import journeyNextForm %}
{% set pageTitleKey = 'pages.checkMobileAppResult.title' %}
{% set googleTagManagerPageId = "checkMobileAppResult" %}
{% set isPageDynamic = false %}

{% block content %}
  <form action="/ipv/page/{{ pageId }}" method="post" novalidate="novalidate">
    <input type="hidden" name="_csrf" value="{{ csrfToken }}">

    <h1 id="page-header" class="govuk-heading-l">{{ 'pages.checkMobileAppResult.header' | translate }}</h1>

    <div id="spinner-container"
          data-ms-between-requests="{{msBetweenRequests}}"
          data-ms-before-informing-of-long-wait="{{msBeforeInformingOfLongWait}}"
          data-ms-before-abort="{{msBeforeAbort}}"
          data-hide-spinner-on-error="true"
          data-aria-alert-completion-text="{{ 'pages.checkMobileAppResult.content.spinner.ariaButtonEnabledMessage' | translate }}">
      <div id="no-js-content" class="govuk-form-group">
        <p class="govuk-body">{{ 'pages.checkMobileAppResult.content.htmlOnlyVersion.paragraph' | translate }}</p>
        <p class="govuk-body">{{ 'pages.checkMobileAppResult.content.htmlOnlyVersion.paragraph2' | translate }}</p>
      </div>
      <div id="wait-content" style="display:none">
        <p class="centre govuk-body">{{ 'pages.checkMobileAppResult.content.spinner.initial.text' | translate }}</p>
      </div>
      <div id="long-wait-content" style="display:none">
        <p class="centre govuk-body">{{ 'pages.checkMobileAppResult.content.spinner.longWait.text' | translate }}</p>
      </div>
      <div id="success-content" style="display:none">
        <p class="centre govuk-body">{{ 'pages.checkMobileAppResult.content.spinner.complete.text' | translate }}</p>
      </div>
      <div id="error-content" style="display:none">
        <p class="govuk-body">{{ 'pages.checkMobileAppResult.content.spinner.error.messageText' | translate }}</p>
        <h2 class="govuk-heading-m">{{ 'pages.checkMobileAppResult.content.spinner.error.whatYouCanDo.heading' | translate }}</h2>
        <p class="govuk-body">{{ 'pages.checkMobileAppResult.content.spinner.error.whatYouCanDo.text' | translate }}</p>
      </div>
    </div>

    <button id="submit-button" type="submit" class="govuk-button govuk-!-margin-top-4">
      {{ 'pages.checkMobileAppResult.continueButtonText' | translate }}
    </button>
  </form>

{% endblock %}

{% block scripts %}
    <script nonce='{{ cspNonce }}' defer type="module" src="/public/javascripts/frontend-ui.js"></script>
    <script nonce='{{ cspNonce }}' defer type="module">
        const button = document.getElementById("submit-button");
        const pageHeading = document.getElementById("page-header");
        button.setAttribute("disabled", true);

        const pollFunction = generatePollApiFunction('{{ apiUrl | safe }}');

        function successFunction() {
          button.removeAttribute("disabled");
        }

        function errorFunction() {
          document.title =  "{{ 'pages.checkMobileAppResult.content.spinner.error.title' | translate }}";
          pageHeading.textContent = "{{ 'pages.checkMobileAppResult.content.spinner.error.heading' | translate }}";
          button.style.display = "none";
        }

        import { useSpinner } from "/public/javascripts/frontend-ui.js";
        useSpinner("spinner-container", pollFunction, successFunction, errorFunction);
    </script>
{% endblock %}
